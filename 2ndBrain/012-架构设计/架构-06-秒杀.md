# 架构-06-秒杀


[TOC]


## 更新
* 2022/06/28，撰写





## 参考资料
* [高并发秒杀的设计精要与实现 | 掘金小册](https://juejin.cn/book/7008372989179723787)
* [京东秒杀架构升级优化实践 | 京东零售技术](https://mp.weixin.qq.com/s/bo46q8ohuk78fqXJTaQavQ)



## 库存问题
* [电商库存系统的防超卖和高并发扣减方案 | 京东零售技术](https://mp.weixin.qq.com/s/XvmQQ1_EtXKTm8J0k3K63Q)


扣减库存，其实包含两个过程
1. 超卖校验
2. 扣减数据的持久化

在秒杀高并发场景下，可以将这两个过程分开，使用 Redis 防止超卖；通过 Redis 防超卖后，扣减数据的持久化过程中只做库存扣减即可。


在「使用 Redis 进行超卖校验」时，如果出现热 Sku，就会打向 Redis 单片，造成单片性能抖动，这个时候可对热 Sku 进行「限流」，比如采用滑动窗口法进行限流。在滑动窗口限流法中，可以设定每 10ms 一个时间窗，对每个时间窗的热 Sku 库存扣减请求进行计数，单台服务器超过计数进行限流，若 10ms 超过 2 个就限流，那么 1s 一台服务器就是 200 个，50 台服务器一秒就可以卖出 1 万个货。


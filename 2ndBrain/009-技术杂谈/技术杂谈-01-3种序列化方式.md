
# 技术杂谈-01-3种序列化方式



[TOC]


## 更新
* 2022/03/15，撰写


## 参考资料
* [msgpack.org](http://msgpack.org/)
* [hessian doc](http://hessian.caucho.com/doc/hessian-serialization.html)
* [两种数据序列化方案性能对比：Msgpack和Json](https://ask.zkbhj.com/?/article/258)
* [类继承导致 RPC 调用 msgpack 序列化问题分析](https://toutiao.io/posts/s9nhng/preview)
* [五句话介绍Hessian序列化](https://cloud.tencent.com/developer/article/1706130)
* [深入浅出序列化——JDK序列化和Hessian序列化](https://juejin.cn/post/6991473304011800590)
* [MsgPack和Hessian序列化的区别](https://juejin.cn/post/7064495591065124878)


## 前言

常用的序列化方式有如下 3 种
1. json
2. messagepack（msgpack）
3. hession


## msgpack


MessagePack 是一个高效的二进制序列化格式。它让你像 JSON 一样可以在各种语言之间交换数据，但是它比 JSON 更快、更小。因为 msgpack 是一个二进制格式，所以没法像 json 后的字符串一样可直观地查看数据。

> It's like JSON,but fast and small. 

![msgpack-json-speed-1](https://image-bed-20181207-1257458714.cos.ap-shanghai.myqcloud.com/back-end-2022/msgpack-json-speed-1.png)


### msgpack字段兼容规则

对一个 bean 对象，msgpack 是按照 bean 对象中属性的顺序进行序列化和反序列化的。

所以在 RPC 服务中，若采用了 msgpack 序列化方式，在修改 bean 对象时，需要注意如下字段兼容规则
1. 不能调整原有字段顺序，不能删减字段，除非是删最后一个字段
2. 新加的字段必须在字段最后面（只是字段顺序，不是文件最后面，getter/setter 方法等随意）
3. 父类的字段不能变，因为父类一变相当于子类的中间插入一个字段


> 满足上面规则，服务端和客户端任一方修改，不会对另一方造成影响。如果是需要父类加字段，或者中间加减字段这种，则需要服务端和调用端同时修改。






## Hession

> Hessian is a dynamically-typed, binary serialization and Web Services protocol designed for object-oriented transmission. 

Hessian 是一种动态类型、二进制序列化和 Web 服务协议，专为面向对象的传输而设计。


**需要注意的是，使用 hession 序列化方式时，父类和子类不能拥有同名的成员变量，否则会存在值覆盖的问题。**

Hessian 会把复杂的对象所有属性存储在一个 Map 中进行序列化。所以在父类、子类中存在同名成员变量的情况下，hessian 序列化时，先序列化子类，然后序列化父类。因此，反序列化结果会导致子类同名成员变量被父类的值覆盖。



## msgpack对比hessian
* Hessian 序列化的时候，会写入字段名称，然后字段值，可以想象为一个 map。
* MsgPack 序列化的时候，不写入字段名字，会按字段顺序写入值，可以想象为一个数组。
* **因此，Hessian 序列化产生的数据包较大，Msgpack 序列化产生的数据包较小。Msgpack 比 Hession 的序列化性能也更好，压缩比也更高。**

![](https://image-bed-20181207-1257458714.cos.ap-shanghai.myqcloud.com/back-end-2022/msgpack-hession-1.png)

* hessian的扩展性更好，上下兼容时可以随意添加字段位置（相当于 map 可以随便赋值）
* msgpack 的性能更佳，上下兼容时，需要保证字段顺序（包括枚举顺序）
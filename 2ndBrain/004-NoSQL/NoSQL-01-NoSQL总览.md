


# NoSQL-01-NoSQL总览



[TOC]

## 更新
* 2022/05/22，撰写




## 参考资料
* [NoSQL 介绍 | runoob.com](https://www.runoob.com/mongodb/nosql.html)
* [关系型数据库 VS 非关系型数据库 | 知乎](https://zhuanlan.zhihu.com/p/78619241)



## 关系型数据库
* 关系型数据库是采用了关系模型来组织数据的数据库。
* 常见的关系型数据库：SQL Server，Oracle，Mysql，PostgreSQL
* 关系型数据库遵循 ACID 规则

## 非关系型数据库（NoSQL）
* 非关系型数据库，即 NoSQL。NoSQL 有时也称作 `Not Only SQL`（不仅仅 SQL）。
* 非关系型数据库不遵循 ACID 规则
* 常见的非关系型数据库：Redis，Hbase，MongoDB，Memcache，全文搜索引擎 Elasticsearch，Neo4J


|     类型  |   部分代表    |             特点         |
|----------|--------------|--------------------------|
|   列存储  |   Hbase      | 按列存储数据的，方便存储结构化和半结构化数据，方便做数据压缩，对某一列/某几列的查询效率较高 |
|  文档存储 |   MongoDB    | 一般用类似JSON的格式存储，存储的内容是文档型的，这样也就有机会对某些字段建立索引，实现关系数据库的某些功能 |
| key-value存储 | Memcache，Redis  | 可以通过 key 快速查询到其 value   |
|   图存储  |    Neo4J    |      图形关系的最佳存储           |
|   对象存储 |   db4o      | 通过类似面向对象语言的语法操作数据库，通过对象的方式存取数据   |
| xml数据库 |   BaseX     |    高效的存储XML数据，并支持XML的内部查询语法 |


### Memcache、Redis和MongoDB的对比

* ref 1-[NoSQL中Memcached、Redis、MongoDB的对比](https://juejin.cn/post/7086380009778053151)


Memcache 和 Redis 这两个 key-value 存储数据库的区别如下。

Memcache
1. 较早出现的 NoSQL 数据库
2. 数据都在内存中，一般不支持数据持久存储。数据不能备份，只能用于缓存使用，且重启后数据全部丢失
3. 支持简单的 key-value 存储，支持的 value 数据类型较单一，不像 Redis 可以支持丰富的数据类型

Redis
1. 几乎覆盖了 Memcache 的绝大部分功能
2. 数据存储在内存中，并且支持数据持久化
3. key-value 存储，支持多种数据格式的 value 存储，如 string，list，hash，set，zset
4. 支持简单的事务需求，但业界使用场景很少，并不成熟


另外，MongoDB的对比如下
1. 文档存储，支持丰富的数据表达，内置了数据分析的功能
2. 适合大容量的存储，适用于海量数据的访问
3. **不支持事务**
4. 从 1.8 版本开始采用 `binlog` 方式支持持久化的可靠性


## CAP定理

> CAP 理论是分布式中基础理论。

CAP 定理（CAP theorem）, 又被称作「布鲁尔定理（Brewer's theorem）」, 它指出对于一个分布式计算系统来说，不可能同时满足以下 3 点
* 一致性（Consistency）：所有节点在同一时间具有相同的数据
* 可用性（Availability）：保证每个请求不管成功或者失败都有响应
* 分区容错性（Partition tolerance）：系统中任意信息的丢失或失败不会影响系统的继续运作。分区容错性强调的是集群分区故障的容错能力。


一个分布式系统不可能同时很好的满足一致性，可用性和分区容错性这三个需求，最多只能同时较好的满足 2个。因此，根据 CAP 原理，可以将 NoSQL 数据库分成了满足 CA 原则，满足 CP 原则和满足 AP 原则三大类
1. CA - 单点集群，满足一致性，可用性的系统，通常在可扩展性上不太强大。典型应用：单机部署版的 MySQL。
2. CP - 满足一致性，分区容错性的系统，通常性能不是特别高。典型应用：Hbase。
3. AP - 满足可用性，分区容错性的系统，通常对一致性要求低一些。典型应用：DynamoDB


![cap-theorem-1](https://image-bed-20181207-1257458714.cos.ap-shanghai.myqcloud.com/back-end-2022/cap-theorem-1.png)


CAP 理论是分布式中基础理论。针对 CAP 理论，延伸出
1. BASE 理论是 CAP 中一致性和可用性权衡的结果，是 CAP 中的 AP 的延伸。（在 NoSQL 中应用广泛）
2. ACID 是传统关系型数据库的设计理念，追求强一致性，是 CAP 中 CP 的延伸。（在 SQL 中应用广泛）

> **ACID 强调的是强一致性，而 Base 理论强调的是最终一致性。**



### Base理论

BASE 理论是 CAP 中一致性和可用性权衡的结果。是 CAP 中的 AP 的延伸。注重可用性和性能优先，根据业务的场景特点，实现弹性的基本可用，然后实现数据的最终一致性。**BASE 理论在 NoSQL 中应用广泛，是 NoSQL 系统设计的事实上的理论支撑。**
* 基本可用 BA（Basically Available）
* 软状态 S（Soft state）
* 最终一致性 E（Eventually consistent）：系统中的所有的数据副本在经过一段时间的同步后，最终能够达到一个一致的状态。最终可以理解为一个短暂的延迟。



### ACID
* ref 1-[用太极拳讲分布式理论 | 悟空聊架构](https://my.oschina.net/u/4499317/blog/4874583)


ACID 是传统关系型数据库的设计理念，追求强一致性。四个指标：原子性、一致性、隔离性、持久性。是 CAP 中 CP 的延伸。
* A (`Atomicity`) 原子性
* C (`Consistency`) 一致性
* I (`Isolation`) 独立性
* D (`Durability`) 持久性



## OLTP和OLAP
* ref 1-[OLTP与OLAP的区别 | 简书](https://www.jianshu.com/p/a895161a9f11)



现阶段，数据处理大致可以分成两大类
1. 联机事务处理：On-Line Transaction Processing，即 `OLTP`
2. 联机分析处理：On-Line Analytical Processing，即 `OLAP`

|   对比项    |      OLTP    |     OLAP   |
|------------|--------------|------------|
|    用户     | 操作人员，低层管理人员 |  决策人员，高级管理人员 |
|    功能     |  日常处理操作  |    分析决策  |
|   工作单元   |   简单的事物  |  复杂的查询和分析 |
|    度量     |    事物吞吐量 |   查询吞吐量，响应时间 |
|     数据    |  当前数据，二维的  | 历史数据，聚集的，多维的 |
|    存储   |   读/写数十条记录   |   读上百万条记录  |
|   DB大小   |   100MB~GB   |   100GB~TB |
|   数据库设计   |   采用实体-联系ER模型和面向应用的数据库设计  |   采用星型或雪花模型和面向主题的数据库设计 |



### OLAP场景的关键特征
* 绝大多数是读请求。
* 数据以相当大的批次（> 1000行）更新，而不是单行更新；或者根本没有更新。
* 已添加到数据库的数据不能修改。
* 对于读取，从数据库中提取相当多的行，但只提取列的一小部分。
* 宽表，即每个表包含着大量的列
* 查询相对较少（通常每台服务器每秒查询数百次或更少）
* 对于简单查询，允许延迟大约 50 毫秒
* 列中的数据相对较小：数字和短字符串（例如，每个URL 60 个字节）
* 处理单个查询时需要高吞吐量（每台服务器每秒可达数十亿行）
* 事务不是必须的
* 对数据一致性要求低
* 每个查询有一个大表。除了他以外，其他的都很小。
* 查询结果明显小于源数据。换句话说，数据经过过滤或聚合，因此结果适合于单个服务器的 RAM 中


针对 OLAP 场景的特征，列式数据库更适合 OLAP 场景（详细分析见 [Clickhouse Cookbook](https://clickhouse.com/docs/zh/)），如使用 Clickhouse 进行数据分析。






## 行式存储和列式存储

* ref 1-[OLTP，OLAP和列族数据库 | blog](https://www.cnblogs.com/starcrm/p/13822100.html)
* ref 2-[行式存储和列式存储 | 知乎](https://zhuanlan.zhihu.com/p/378814476)


1. 行式存储：一般用于 OLTP 场景，写入速度极快，面向事物，如 MySQL，Oracle
2. 列式存储：一般用于 OLTP 场景，用于海量数据分析，如 Hive，Clickhouse



行式存储的适用场景
1. 适合随机的增删改查操作
2. 需要在行中选取所有属性的查询操作
3. 需要频繁插入或更新的操作，其操作与索引和行的大小更为相关

列式存储的适用场景
1. 大数据场景和海量数据分析
2. 列式数据库可在内存中高效组装各列的值，最终形成关系记录集，因此可以大幅降低磁盘IO消耗，并降低查询响应时间。非常适合数据仓库和分布式的应用。


